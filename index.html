
<!DOCTYPE html>
<head>

</head>
<body>
	<div class="analog">
		<div class="analog_value">
			<span id="noiseValue">0</span><font class="unit">dB</font>
		</div>
	</div>
	<div class="analog">
		<div class="analog_value2">
			<span id="smokeValue">0</span><font class="unit">ppm</font>
		</div>
	</div>
	<div class="analog">
		<div class="analog_value3">
			<span id="tempValue">0</span><font class="unit">*C</font>
		</div>
	</div>


</body>

<script>

	setup();
	if (window.Worker) {
		var worker = new Worker("worker.js");
	}
			
	var json = new Object();
	
	var tempValue;
	var smokeValue;
	var noiseValue;
	
	function loop() {
		json1 = {"request": "read", "write": {"pin":"0", "value":"0"}};
			
		worker.postMessage(json1);
			
		worker.onmessage = function(result) {
			alert(result.data.tempValue);
		}	
		
		tempValue = toCelsius(cpf.get("d3"));
		document.getElementById("tempValue").innerHTML = tempValue;
		smokeValue = cpf.get("a0");	
		document.getElementById("smokeValue").innerHTML = smokeValue;
		noiseValue = cpf.get("a1");
		document.getElementById("noiseValue").innerHTML = noiseValue;

		if (tempValue != 0 && smokeValue != 0 && noiseValue != 0) {
			callPHP('temp=' + tempValue + '&smk=' + smokeValue + '&noise=' + noiseValue)
		}
		setTimeout("loop()", 1000);
	}
	
	function callPHP(params) {
    		var httpc = new XMLHttpRequest(); // simplified for clarity
    		var url = "innobbatus.000webhostapp.com/sendsors/insert.php";
    		httpc.open("POST", url, true); // sending as POST

    		httpc.setRequestHeader("Content-Type", "application/x-www-form-urlencoded");
    		httpc.setRequestHeader("Content-Length", params.length); // POST request MUST have a Content-Length header (as per HTTP/1.1)

    		httpc.onreadystatechange = function() { //Call a function when the state changes.
       	 	if(httpc.readyState == 4 && httpc.status == 200) { // complete and no errors
           		alert(httpc.responseText); // some processing here, or whatever you want to do with the response
        	}
    		};
    		httpc.send(params);
	}

	loop();

	// cpf setup
	function setup(){
		if(cpf)
			cpf.setPinMode('["resetPin"],["setPinMode", "analog", 0, "INPUT"],["setPinMode", "analog", 1, "INPUT"],["setPinMode", "digital", 3,"INPUT"]');
		
	}

</script>
</html>
